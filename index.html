
<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>ØªØªØ¨Ø¹ Ø§Ù„Ù…ÙˆÙ‚Ø¹</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: Arial; text-align: center; padding: 20px; }
    .status { font-size: 18px; margin-top: 10px; }
    .coords { font-weight: bold; margin-top: 10px; }
  </style>
</head>
<body>
  <h2>ØªØªØ¨Ø¹ Ø§Ù„Ù…ÙˆÙ‚Ø¹ - Ø¥Ø±Ø³Ø§Ù„ Ù…Ø¨Ø§Ø´Ø±</h2>
  <div class="status">Ø¬Ø§Ø±ÙŠ ØªÙØ¹ÙŠÙ„ GPS...</div>
  <div class="coords">Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§...</div>

  <script>
    const statusEl = document.querySelector('.status');
    const coordsEl = document.querySelector('.coords');

    const LAYER_URL = "https://services6.arcgis.com/n6MCRBPSvlKSoB6e/arcgis/rest/services/%D8%AA%D8%AA%D8%A8%D8%B9_%D8%B4%D8%A7%D8%AD%D9%86%D8%A7%D8%AA_%D8%AA%D8%AC%D8%B1%D8%A8%D8%A9_%D8%B1%D8%A8%D8%B7_gps/FeatureServer/0/addFeatures"; // ØºÙŠÙ‘Ø± Ù‡Ø°Ø§ Ù„Ø§Ø­Ù‚Ù‹Ø§ Ø¨Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ

    const device_id = "Ø¬Ù‡Ø§Ø²_ØªØ¬Ø±ÙŠØ¨ÙŠ"; // ÙŠÙ…ÙƒÙ† ØªØºÙŠÙŠØ±Ù‡ Ù„Ø§Ø­Ù‚Ù‹Ø§ Ù„ÙƒÙ„ Ù…ÙˆØ¸Ù

    function sendLocation(lat, lon) {
      const attributes = {
        device_id: device_id,
        status: "Ù†Ø´Ø·",
        time_stamp: new Date().toISOString()
      };

      const geometry = {
        x: lon,
        y: lat,
        spatialReference: { wkid: 4326 }
      };

      fetch(LAYER_URL, {
        method: 'POST',
        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
        body: `f=json&features=` + encodeURIComponent(JSON.stringify([{ attributes, geometry }]))
      })
      .then(res => res.json())
      .then(data => {
        if (data.addResults && data.addResults[0].success) {
          statusEl.textContent = 'âœ… ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø¨Ù†Ø¬Ø§Ø­';
        } else {
          statusEl.textContent = 'âŒ ÙØ´Ù„ ÙÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„';
        }
      })
      .catch(err => {
        statusEl.textContent = 'âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„';
      });
    }

    function trackLocation() {
      if (navigator.geolocation) {
        navigator.geolocation.watchPosition(position => {
          const lat = position.coords.latitude;
          const lon = position.coords.longitude;
          coordsEl.textContent = `Ø®Ø· Ø§Ù„Ø¹Ø±Ø¶: ${lat.toFixed(6)} / Ø®Ø· Ø§Ù„Ø·ÙˆÙ„: ${lon.toFixed(6)}`;
          sendLocation(lat, lon);
        }, error => {
          statusEl.textContent = 'âš ï¸ ØªØ¹Ø°Ø± ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹';
        }, {
          enableHighAccuracy: true,
          maximumAge: 0,
          timeout: 5000
        });
      } else {
        statusEl.textContent = 'ğŸ“µ Ø¬Ù‡Ø§Ø²Ùƒ Ù„Ø§ ÙŠØ¯Ø¹Ù… GPS';
      }
    }

    trackLocation();
    setInterval(trackLocation, 5000); // Ø¥Ø±Ø³Ø§Ù„ ÙƒÙ„ 5 Ø«ÙˆØ§Ù†ÙŠ
  </script>
</body>
</html>
